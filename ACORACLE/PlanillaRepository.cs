using ACDATA;
using System;
using System.Collections.Generic;
using System.Data.OracleClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ACORACLE
{
    public class PlanillaRepository 

    {     public   string _connectionString;

        public class PlanillaDTO
        {
            public string CODPROD { get; set; }
            public string NOMPROD { get; set; }
            public int UBICACION { get; set; }
            public string tipo { get; set; }

            // 2023
            public decimal v202301 { get; set; }
            public decimal v202302 { get; set; }
            public decimal v202303 { get; set; }
            public decimal v202304 { get; set; }
            public decimal v202305 { get; set; }
            public decimal v202306 { get; set; }
            public decimal v202307 { get; set; }
            public decimal v202308 { get; set; }
            public decimal v202309 { get; set; }
            public decimal v202310 { get; set; }
            public decimal v202311 { get; set; }
            public decimal v202312 { get; set; }

            // 2024
            public decimal v202401 { get; set; }
            public decimal v202402 { get; set; }
            public decimal v202403 { get; set; }
            public decimal v202404 { get; set; }
            public decimal v202405 { get; set; }
            public decimal v202406 { get; set; }
            public decimal v202407 { get; set; }
            public decimal v202408 { get; set; }
            public decimal v202409 { get; set; }
            public decimal v202410 { get; set; }
            public decimal v202411 { get; set; }
            public decimal v202412 { get; set; }

            // 2025
            public decimal v202501 { get; set; }
            public decimal v202502 { get; set; }
            public decimal v202503 { get; set; }
            public decimal v202504 { get; set; }
            public decimal v202505 { get; set; }
            public decimal v202506 { get; set; }
            public decimal v202507 { get; set; }
            public decimal v202508 { get; set; }
            public decimal v202509 { get; set; }
            public decimal v202510 { get; set; }
            public decimal v202511 { get; set; }
            public decimal v202512 { get; set; }
        }

        public List<PlanillaDTO> ObtenerDatosPlanilla( )
        {
            var datos = new List<PlanillaDTO>();

            using (var connection = new OracleConnection(_connectionString))
            {
                connection.Open();
                var command = new OracleCommand(ObtenerConsultaSQL(), connection);

                using (var reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                      
                            var planilla = new PlanillaDTO
                            {
                                CODPROD = reader["CODPROD"].ToString(),
                                NOMPROD = reader["NOMPROD"].ToString(),
                                UBICACION = Convert.ToInt32(reader["UBICACION"]),
                                tipo = reader["tipo"].ToString(),
                                // 2023
                                v202301 = Convert.ToDecimal(reader["v202301"]),
                                v202302 = Convert.ToDecimal(reader["v202302"]),
                                v202303 = Convert.ToDecimal(reader["v202303"]),
                                v202304 = Convert.ToDecimal(reader["v202304"]),
                                v202305 = Convert.ToDecimal(reader["v202305"]),
                                v202306 = Convert.ToDecimal(reader["v202306"]),
                                v202307 = Convert.ToDecimal(reader["v202307"]),
                                v202308 = Convert.ToDecimal(reader["v202308"]),
                                v202309 = Convert.ToDecimal(reader["v202309"]),
                                v202310 = Convert.ToDecimal(reader["v202310"]),
                                v202311 = Convert.ToDecimal(reader["v202311"]),
                                v202312 = Convert.ToDecimal(reader["v202312"]),
                                // 2024
                                v202401 = Convert.ToDecimal(reader["v202401"]),
                                v202402 = Convert.ToDecimal(reader["v202402"]),
                                v202403 = Convert.ToDecimal(reader["v202403"]),
                                v202404 = Convert.ToDecimal(reader["v202404"]),
                                v202405 = Convert.ToDecimal(reader["v202405"]),
                                v202406 = Convert.ToDecimal(reader["v202406"]),
                                v202407 = Convert.ToDecimal(reader["v202407"]),
                                v202408 = Convert.ToDecimal(reader["v202408"]),
                                v202409 = Convert.ToDecimal(reader["v202409"]),
                                v202410 = Convert.ToDecimal(reader["v202410"]),
                                v202411 = Convert.ToDecimal(reader["v202411"]),
                                v202412 = Convert.ToDecimal(reader["v202412"]),
                                // 2025
                                v202501 = Convert.ToDecimal(reader["v202501"]),
                                v202502 = Convert.ToDecimal(reader["v202502"]),
                                v202503 = Convert.ToDecimal(reader["v202503"]),
                                v202504 = Convert.ToDecimal(reader["v202504"]),
                                v202505 = Convert.ToDecimal(reader["v202505"]),
                                v202506 = Convert.ToDecimal(reader["v202506"]),
                                v202507 = Convert.ToDecimal(reader["v202507"]),
                                v202508 = Convert.ToDecimal(reader["v202508"]),
                                v202509 = Convert.ToDecimal(reader["v202509"]),
                                v202510 = Convert.ToDecimal(reader["v202510"]),
                                v202511 = Convert.ToDecimal(reader["v202511"]),
                                v202512 = Convert.ToDecimal(reader["v202512"])
                            };

                            datos.Add(planilla);
                       
                    }
                }
            }

            return datos;
        }

        private string ObtenerConsultaSQL()
        {
            // Aquí va la consulta SQL que proporcionaste
            return @"SELECT 
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    0 AS UBICACION, 
    'VENTAS_PRODUCCION' AS tipo, 
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_VENTAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM

union all



SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    4 AS UBICACION,
    'CUARENTENA' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_CUARENTENA_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
 union all
 SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    5 AS UBICACION,
    'ENTREGAS' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_ENTREGAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY

    f.CODTERM, f.NOMTERM, v.CODIGO
    union all
    SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    6 AS UBICACION,
    'SALIDAS' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_SALIDAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM,v.CODIGO


union all
SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    7 AS UBICACION,
    'PPTO VENTAS' AS tipo,
 NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_VENTASMMPPTO_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
union all

    SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    8 AS UBICACION,
    'STOCKREAL' AS tipo,
 NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_STOCKREAL_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
    order by CODPROD, NOMPROD, ubicacion, tipo ";
        }

        private string ObtenerConsultaSQL(string agno1, string agno2, string agno3)
        {
            // Aquí va la consulta SQL que proporcionaste
            string query =  @"SELECT 
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    0 AS UBICACION, 
    'VENTAS_PRODUCCION' AS tipo, 
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_VENTAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM

union all



SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    4 AS UBICACION,
    'CUARENTENA' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_CUARENTENA_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
 union all
 SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    5 AS UBICACION,
    'ENTREGAS' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_ENTREGAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY

    f.CODTERM, f.NOMTERM, v.CODIGO
    union all
    SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    6 AS UBICACION,
    'SALIDAS' AS tipo,
    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_SALIDAS_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM,v.CODIGO


union all
SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    7 AS UBICACION,
    'PPTO VENTAS' AS tipo,
 NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_VENTASMMPPTO_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
union all

    SELECT
    NVL(f.CODTERM, 'SIN CODIGO') AS CODPROD,
    NVL(RPAD(LTRIM(RTRIM(f.NOMTERM)), 50, '.') || ' ==> ' || f.CODTERM, 'SIN DESCRIPCION') AS NOMPROD,
    8 AS UBICACION,
    'STOCKREAL' AS tipo,

    NVL(SUM(CASE WHEN v.ANOMES = '202301' THEN v.VALOR ELSE 0 END), 0) AS V202301,
    NVL(SUM(CASE WHEN v.ANOMES = '202302' THEN v.VALOR ELSE 0 END), 0) AS V202302,
    NVL(SUM(CASE WHEN v.ANOMES = '202303' THEN v.VALOR ELSE 0 END), 0) AS V202303,
    NVL(SUM(CASE WHEN v.ANOMES = '202304' THEN v.VALOR ELSE 0 END), 0) AS V202304,
    NVL(SUM(CASE WHEN v.ANOMES = '202305' THEN v.VALOR ELSE 0 END), 0) AS V202305,
    NVL(SUM(CASE WHEN v.ANOMES = '202306' THEN v.VALOR ELSE 0 END), 0) AS V202306,
    NVL(SUM(CASE WHEN v.ANOMES = '202307' THEN v.VALOR ELSE 0 END), 0) AS V202307,
    NVL(SUM(CASE WHEN v.ANOMES = '202308' THEN v.VALOR ELSE 0 END), 0) AS V202308,
    NVL(SUM(CASE WHEN v.ANOMES = '202309' THEN v.VALOR ELSE 0 END), 0) AS V202309,
    NVL(SUM(CASE WHEN v.ANOMES = '202310' THEN v.VALOR ELSE 0 END), 0) AS V202310,
    NVL(SUM(CASE WHEN v.ANOMES = '202311' THEN v.VALOR ELSE 0 END), 0) AS V202311,
    NVL(SUM(CASE WHEN v.ANOMES = '202312' THEN v.VALOR ELSE 0 END), 0) AS V202312,
    NVL(SUM(CASE WHEN v.ANOMES = '202401' THEN v.VALOR ELSE 0 END), 0) AS V202401,
    NVL(SUM(CASE WHEN v.ANOMES = '202402' THEN v.VALOR ELSE 0 END), 0) AS V202402,
    NVL(SUM(CASE WHEN v.ANOMES = '202403' THEN v.VALOR ELSE 0 END), 0) AS V202403,
    NVL(SUM(CASE WHEN v.ANOMES = '202404' THEN v.VALOR ELSE 0 END), 0) AS V202404,
    NVL(SUM(CASE WHEN v.ANOMES = '202405' THEN v.VALOR ELSE 0 END), 0) AS V202405,
    NVL(SUM(CASE WHEN v.ANOMES = '202406' THEN v.VALOR ELSE 0 END), 0) AS V202406,
    NVL(SUM(CASE WHEN v.ANOMES = '202407' THEN v.VALOR ELSE 0 END), 0) AS V202407,
    NVL(SUM(CASE WHEN v.ANOMES = '202408' THEN v.VALOR ELSE 0 END), 0) AS V202408,
    NVL(SUM(CASE WHEN v.ANOMES = '202409' THEN v.VALOR ELSE 0 END), 0) AS V202409,
    NVL(SUM(CASE WHEN v.ANOMES = '202410' THEN v.VALOR ELSE 0 END), 0) AS V202410,
    NVL(SUM(CASE WHEN v.ANOMES = '202411' THEN v.VALOR ELSE 0 END), 0) AS V202411,
    NVL(SUM(CASE WHEN v.ANOMES = '202412' THEN v.VALOR ELSE 0 END), 0) AS V202412,
    NVL(SUM(CASE WHEN v.ANOMES = '202501' THEN v.VALOR ELSE 0 END), 0) AS V202501,
    NVL(SUM(CASE WHEN v.ANOMES = '202502' THEN v.VALOR ELSE 0 END), 0) AS V202502,
    NVL(SUM(CASE WHEN v.ANOMES = '202503' THEN v.VALOR ELSE 0 END), 0) AS V202503,
    NVL(SUM(CASE WHEN v.ANOMES = '202504' THEN v.VALOR ELSE 0 END), 0) AS V202504,
    NVL(SUM(CASE WHEN v.ANOMES = '202505' THEN v.VALOR ELSE 0 END), 0) AS V202505,
    NVL(SUM(CASE WHEN v.ANOMES = '202506' THEN v.VALOR ELSE 0 END), 0) AS V202506,
    NVL(SUM(CASE WHEN v.ANOMES = '202507' THEN v.VALOR ELSE 0 END), 0) AS V202507,
    NVL(SUM(CASE WHEN v.ANOMES = '202508' THEN v.VALOR ELSE 0 END), 0) AS V202508,
    NVL(SUM(CASE WHEN v.ANOMES = '202509' THEN v.VALOR ELSE 0 END), 0) AS V202509,
    NVL(SUM(CASE WHEN v.ANOMES = '202510' THEN v.VALOR ELSE 0 END), 0) AS V202510,
    NVL(SUM(CASE WHEN v.ANOMES = '202511' THEN v.VALOR ELSE 0 END), 0) AS V202511,
    NVL(SUM(CASE WHEN v.ANOMES = '202512' THEN v.VALOR ELSE 0 END), 0) AS V202512
FROM
    foprte f
left OUTER JOIN  FACTURAS.T_STOCKREAL_PRODUCCION v ON f.CODTERM = v.CODIGO
GROUP BY
    f.CODTERM, f.NOMTERM, v.CODIGO
    order by CODPROD, NOMPROD, ubicacion, tipo ";
    
            return query;
        } 


    }



   
}
