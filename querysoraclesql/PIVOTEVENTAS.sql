VAR ANODESDE NUMBER;
VAR ANOHASTA NUMBER;
 
WITH FECHAS AS (
 SELECT TO_CHAR(ADD_MONTHS(TO_DATE('2023-01-01', 'YYYY-MM-DD'), LEVEL - 1), 'YYYYMM') AS ANOMES
  FROM DUAL
  CONNECT BY LEVEL <= 12 * (:ANOHASTA - :ANODESDE + 1)
),
PIVOTE AS (
  SELECT V.CODIGO, V.DESCRIPCION, V.ANOMES, V.MOVIMIENTO
  FROM T_VENTAS_PRODUCCION V
  WHERE V.AGNO BETWEEN :AÑODESDE AND :AÑOHASTA
)
SELECT P.CODIGO, P.DESCRIPCION,
       MAX(CASE WHEN P.ANOMES = '202301' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202301,
       MAX(CASE WHEN P.ANOMES = '202302' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202302,
       MAX(CASE WHEN P.ANOMES = '202303' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202303,
       MAX(CASE WHEN P.ANOMES = '202304' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202304,
       MAX(CASE WHEN P.ANOMES = '202305' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202305,
       MAX(CASE WHEN P.ANOMES = '202306' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202306,
       MAX(CASE WHEN P.ANOMES = '202307' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202307,
       MAX(CASE WHEN P.ANOMES = '202308' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202308,
       MAX(CASE WHEN P.ANOMES = '202309' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202309,
       MAX(CASE WHEN P.ANOMES = '202310' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202310,
       MAX(CASE WHEN P.ANOMES = '202311' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202311,
       MAX(CASE WHEN P.ANOMES = '202312' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202312,
       MAX(CASE WHEN P.ANOMES = '202401' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202401,
       MAX(CASE WHEN P.ANOMES = '202402' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202402,
       MAX(CASE WHEN P.ANOMES = '202403' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202403,
       MAX(CASE WHEN P.ANOMES = '202404' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202404,
       MAX(CASE WHEN P.ANOMES = '202405' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202405,
       MAX(CASE WHEN P.ANOMES = '202406' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202406,
       MAX(CASE WHEN P.ANOMES = '202407' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202407,
       MAX(CASE WHEN P.ANOMES = '202408' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202408,
       MAX(CASE WHEN P.ANOMES = '202409' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202409,
       MAX(CASE WHEN P.ANOMES = '202410' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202410,
       MAX(CASE WHEN P.ANOMES = '202411' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202411,
       MAX(CASE WHEN P.ANOMES = '202412' THEN P.MOVIMIENTO ELSE 0 END) AS ANOMES_202412
FROM PIVOTE P
GROUP BY P.CODIGO, P.DESCRIPCION
ORDER BY P.CODIGO;